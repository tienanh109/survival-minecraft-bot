<!-- webui/index.html -->
<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Bot Config Panel</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <div class="container">
    <header>
      <h1>ğŸ® Minecraft Bot Config (Beta)</h1>
      <button id="theme-toggle">ğŸŒ™</button>
    </header>

    <form id="config-form">
      <h2>Cáº¥u hÃ¬nh káº¿t ná»‘i</h2>
      <label>Host <input type="text" name="host" /></label>
      <label>Port <input type="number" name="port" /></label>
      <label>PhiÃªn báº£n <input type="text" name="version" /></label>
      <label>Auth
        <select name="auth">
          <option value="offline">offline</option>
          <option value="mojang">mojang</option>
          <option value="microsoft">microsoft</option>
        </select>
      </label>

      <h2>TÃ i khoáº£n</h2>
      <label>Username <input type="text" name="username" /></label>
      <label>Password <input type="password" name="password" /></label>

      <h2>Giao tiáº¿p</h2>
      <label>Prefix <input type="text" name="prefix" /></label>
      <label><input type="checkbox" name="autoRespondOnError" /> Tráº£ lá»i khi lá»—i</label>
      <label><input type="checkbox" name="hideErrors" /> áº¨n lá»—i console</label>

      <h2>Má»Ÿ rá»™ng</h2>
      <label><input type="checkbox" name="logging" /> Ghi log</label>
      <label><input type="checkbox" name="logChat" /> Ghi log chat</label>

      <h2>Whitelist</h2>
      <textarea name="whitelist" placeholder="TÃªn ngÆ°á»i chÆ¡i, má»—i dÃ²ng má»™t tÃªn"></textarea>

      <div class="buttons">
        <button type="submit">ğŸ’¾ LÆ°u cáº¥u hÃ¬nh</button>
        <button id="start-bot" type="button">ğŸš€ Khá»Ÿi Ä‘á»™ng bot</button>
        <button id="stop-bot" type="button">ğŸ›‘ Dá»«ng bot</button>
        <span id="bot-status">âšª ChÆ°a rÃµ</span>
      </div>
    </form>

    <footer>
      <p>Made by tienanh109 â€¢ <a href="https://github.com/tienanh109/survival-minecraft-bot" target="_blank">GitHub</a></p>
    </footer>
  </div>
  <script>
    const themeToggle = document.getElementById('theme-toggle');
    const form = document.getElementById('config-form');
    const startBtn = document.getElementById('start-bot');
    const stopBtn = document.getElementById('stop-bot');
    const statusSpan = document.getElementById('bot-status');

    // Toggle theme
    themeToggle.onclick = () => {
      document.body.classList.toggle('dark')
      themeToggle.textContent = document.body.classList.contains('dark') ? 'â˜€ï¸' : 'ğŸŒ™'
    }

    // Fetch config
    fetch('/api/config').then(res => res.json()).then(cfg => {
      for (const key in cfg) {
        const el = form.elements[key]
        if (!el) continue

        if (el.type === 'checkbox') el.checked = cfg[key]
        else if (el.type === 'textarea' && Array.isArray(cfg[key])) el.value = cfg[key].join('\n')
        else el.value = cfg[key]
      }
    })

    // Save config
    form.onsubmit = async (e) => {
      e.preventDefault()
      const data = {}
      for (const el of form.elements) {
        if (!el.name) continue
        if (el.type === 'checkbox') data[el.name] = el.checked
        else if (el.type === 'textarea') data[el.name] = el.value.split('\n').map(x => x.trim()).filter(Boolean)
        else data[el.name] = el.value
      }

      const res = await fetch('/api/config', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(data)
      })

      if (res.ok) alert('âœ… ÄÃ£ lÆ°u thÃ nh cÃ´ng!')
      else alert('âŒ Lá»—i khi lÆ°u config.')
    }

    // Start bot
    startBtn.onclick = async () => {
      const res = await fetch('/api/start', { method: 'POST' })
      if (res.ok) {
        alert('ğŸ¤– Bot Ä‘ang khá»Ÿi Ä‘á»™ng...')
        updateStatus()
      } else alert('âŒ KhÃ´ng thá»ƒ khá»Ÿi Ä‘á»™ng bot.')
    }

    // Stop bot
    stopBtn.onclick = async () => {
      const res = await fetch('/api/stop', { method: 'POST' })
      if (res.ok) {
        alert('ğŸ›‘ Bot Ä‘Ã£ dá»«ng.')
        updateStatus()
      } else alert('âŒ KhÃ´ng thá»ƒ dá»«ng bot.')
    }

    // Update bot status
    async function updateStatus() {
      try {
        const res = await fetch('/api/status')
        const data = await res.json()
        statusSpan.textContent = data.running ? 'ğŸŸ¢ Äang cháº¡y' : 'ğŸ”´ ÄÃ£ dá»«ng'
      } catch (e) {
        statusSpan.textContent = 'âšª KhÃ´ng rÃµ'
      }
    }

    // Tá»± Ä‘á»™ng check tráº¡ng thÃ¡i bot má»—i 3s
    setInterval(updateStatus, 3000)
    updateStatus()
  </script>
</body>
</html>
